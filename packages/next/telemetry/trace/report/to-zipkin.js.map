{"version":3,"sources":["../../../../telemetry/trace/report/to-zipkin.ts"],"names":["ipv4","port","zipkinUrl","reportToLocalHost","timestamp","parentId","traceId","tags","headers","body","JSON"],"mappings":";;;;;AAAA,IAAA,OAAA,GAAA,OAAA,CAAA,QAAA,CAAA;;AACA,IAAA,UAAA,GAAA,sBAAA,CAAA,OAAA,CAAA,YAAA,CAAA,CAAA;;;;;;AAEA;;AACA,IAAI,OAAJ,GAAc,OAAA,CAAA,GAAA,CAAA,QAAd;;AAEC,IAAA,CAAA,OAAA,EAAA;;AAED;;AAEEA,MAAI,aAFgB,GAAA;AAGpBC,EAAAA,WAAM,EAAA,cAHc;AAAtB,EAAA,IAAA,EAAA,WAAsB;AAKtB,EAAA,IAAMC,EAAN;AALsB,CAEpBF;AAKF,MAAMG,SAAAA,GAAAA,UAAoB,aAAA,CAAA,IAGxBC,IAHwB,aAKxBC,CALwB,IAAA,eAA1B;;AAUMC,MADF,iBAAA,GAAA,CAAA,IAAA,EAAA,QAAA,EAAA,SAAA,EAAA,EAAA,EAAA,QAAA,EAAA,KAAA,KAAA;AAEED,QAAAA,IAFF,GAAA,CAAA;AAAA,IAAA,OAAA;AAAA,IAAA,QAAA;AAAA,IAAA,IAAA;AAAA,IAAA,EAAA;AAQEE,IAAAA,SARF;AAYF,IAAA,QAZE;iBAAA;AAaF,IAAA,IAAA,EAAA;AAbE,GAAA,CAEEF,CAaFG;AAbEH;AAaO,GAFM,GAAA,UAAA,CAAA,OAEN,EAFM,SAEN,EAFM;AAGfI,IAAAA,MAAMC,EAAAA,MAHS;AAAjB,IAAA,OAIS,EAJT;AAtBF,sBAAA;AAsBE,KAAiB;eAOJP,S,CAAAA,I;AAPI,GAEN,E,KAAA,C,QAAA;CAdPG","sourcesContent":["import { randomBytes } from 'crypto'\r\nimport fetch from 'node-fetch'\r\n\r\nlet traceId = process.env.TRACE_ID\r\nif (!traceId) {\r\n  traceId = process.env.TRACE_ID = randomBytes(8).toString('hex')\r\n}\r\n\r\nconst localEndpoint = {\r\n  serviceName: 'zipkin-query',\r\n  ipv4: '127.0.0.1',\r\n  port: 9411,\r\n}\r\nconst zipkinUrl = `http://${localEndpoint.ipv4}:${localEndpoint.port}/api/v2/spans`\r\n\r\nconst reportToLocalHost = (\r\n  name: string,\r\n  duration: number,\r\n  timestamp: number,\r\n  id: string,\r\n  parentId?: string,\r\n  attrs?: Object\r\n) => {\r\n  const body = [\r\n    {\r\n      traceId,\r\n      parentId,\r\n      name,\r\n      id,\r\n      timestamp,\r\n      duration,\r\n      localEndpoint,\r\n      tags: attrs,\r\n    },\r\n  ]\r\n\r\n  // We intentionally do not block on I/O here.\r\n  fetch(zipkinUrl, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify(body),\r\n  }).catch(() => {})\r\n}\r\n\r\nexport default reportToLocalHost\r\n"]}